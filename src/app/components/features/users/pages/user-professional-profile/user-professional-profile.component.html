<div class="user-professional-profile">
  <div class="header">
    <button class="back-btn" (click)="goBack()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
      </svg>
      Volver a Usuarios
    </button>
    <h1>Perfil Profesional</h1>
  </div>
  
  <div class="content" *ngIf="professionalProfile; else loading">
    <!-- Copia completa del professional-detail component -->
    <section class="profile">
      <div class="hero">
        <div class="avatar-container">
          <img 
            class="avatar" 
            [src]="professionalProfile.profile_picture || 'https://i.pravatar.cc/120?img=12'" 
            alt="Foto del profesional" 
          />
          <div class="avatar-overlay">
            <input 
              type="file" 
              id="profile-picture" 
              accept="image/*" 
              (change)="onImageSelected($event)"
              class="file-input"
            />
            <label for="profile-picture" class="upload-btn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
              </svg>
              Cambiar foto
            </label>
          </div>
        </div>
        <div class="hero-info">
          <h2 class="name">{{ professionalProfile.name || 'Profesional' }}</h2>
          <div class="subtitle">{{ professionalProfile.specialty || 'Especialidad' }}</div>
          <p class="summary">{{ professionalProfile.description || 'Descripción del profesional.' }}</p>
          <div class="location">{{ professionalProfile.location || 'Córdoba, Argentina' }}</div>
        </div>
        <div class="hero-actions">
          <a class="btn primary" *ngIf="contactUrl; else noPhone" [href]="contactUrl" target="_blank" rel="noopener noreferrer">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" style="margin-right:8px">
              <path d="M20.52 3.48A11.86 11.86 0 0 0 12.05 0C5.5.06.25 5.31.31 11.86c.01 2.08.56 4.11 1.6 5.9L0 24l6.4-1.87a11.83 11.83 0 0 0 5.64 1.45h.05c6.55-.06 11.8-5.31 11.86-11.86A11.83 11.83 0 0 0 20.52 3.48ZM12.1 21.3h-.04a9.5 9.5 0 0 1-4.85-1.33l-.35-.2-3.8 1.1 1.1-3.7-.22-.38a9.45 9.45 0 0 1-1.45-5.06C2.43 6.6 6.6 2.44 11.99 2.4h.04c5.38 0 9.55 4.16 9.6 9.54-.06 5.38-4.22 9.55-9.53 9.36Zm5.48-7.09c-.3-.15-1.8-.89-2.08-.99-.28-.1-.49-.15-.7.15-.2.3-.8.99-.98 1.19-.18.2-.36.23-.66.08-.3-.15-1.25-.46-2.38-1.47a9.03 9.03 0 0 1-1.67-2.06c-.18-.3 0-.46.14-.61.14-.14.3-.36.45-.54.15-.18.2-.3.3-.5.1-.2.05-.38-.02-.53-.08-.15-.7-1.69-.96-2.32-.25-.6-.5-.52-.7-.53l-.6-.01c-.2 0-.53.08-.8.38s-1.05 1.03-1.05 2.5 1.08 2.9 1.23 3.1c.15.2 2.12 3.23 5.14 4.53.72.31 1.28.5 1.7.64.72.23 1.38.2 1.9.12.58-.09 1.8-.74 2.06-1.45.25-.71.25-1.32.18-1.45-.07-.13-.27-.21-.57-.36Z"/>
            </svg>
            Contactar
          </a>
          <ng-template #noPhone>
            <button class="btn primary" disabled>Contactar</button>
          </ng-template>
          <button class="link">Reportar perfil</button>
        </div>
      </div>

      <div class="grid">
        <!-- Columna izquierda: Datos personales (arriba) y Últimos trabajos (abajo) -->
        <div class="col">
        <div class="card">
          <h3>Datos Personales</h3>
          <div class="list">
            <div class="row"><span>DNI</span><strong>{{ $any(professionalProfile).document_number || '—' }}</strong></div>
            <div class="row"><span>Correo</span><strong>{{ professionalProfile.email || 'sin-correo@example.com' }}</strong></div>
            <div class="row"><span>Teléfono</span><strong>{{ professionalProfile.phone || '+54 9 351 456 8980' }}</strong></div>
            <div class="row"><span>Dirección</span><strong>{{ $any(professionalProfile).address_display || '—' }}</strong></div>
            <div class="row"><span>Registrado el</span><strong>{{ (professionalProfile.created_at | date:'dd/MM/yyyy') || 'Sin datos para mostrar' }}</strong></div>
            <div class="row"><span>Nacionalidad</span><strong>{{ $any(professionalProfile).nationality || '—' }}</strong></div>
            <div class="row"><span>Fecha de nacimiento</span><strong>{{ ($any(professionalProfile).birth_date | date:'dd/MM/yyyy') || '—' }}</strong></div>
            <div class="row"><span>Estado</span><strong>Activo</strong></div>
            <div class="row"><span>Disponibilidad</span><strong>Inmediata</strong></div>
            <div class="row"><span>Experiencia</span><strong>+{{ professionalProfile.experienceYears || 12 }} años</strong></div>
          </div>
        </div>

        <div class="card">
          <h3>Últimos Trabajos</h3>
          <div class="work">
            <img src="https://picsum.photos/seed/e1/320/160" alt="Trabajo" />
            <div>
              <div class="work-title">Renovación eléctrica en vivienda antigua</div>
              <div class="work-meta">Córdoba Capital · Abr. 2024</div>
            </div>
          </div>
          <div class="work">
            <img src="https://picsum.photos/seed/e2/320/160" alt="Trabajo" />
            <div>
              <div class="work-title">Automatización de luminarias</div>
              <div class="work-meta">Alta Gracia · Feb. 2024</div>
            </div>
          </div>
        </div>

        </div>

        <!-- Columna derecha: Especialidades (arriba), Comentarios (medio), Valoraciones (abajo) -->
        <div class="col">
        <div class="card specialties">
          <h3>Especialidades</h3>
          <div class="chips">
            <span class="chip" *ngFor="let skill of professionalProfile.skills">{{ skill }}</span>
            <span class="chip" *ngIf="!professionalProfile.skills || professionalProfile.skills.length === 0">Instalaciones eléctricas</span>
            <span class="chip" *ngIf="!professionalProfile.skills || professionalProfile.skills.length === 0">Tableros trifásicos</span>
            <span class="chip" *ngIf="!professionalProfile.skills || professionalProfile.skills.length === 0">Domótica</span>
          </div>
        </div>

        <div class="card">
          <h3>Comentarios</h3>
          <ng-container *ngIf="questions && questions.length > 0; else noComments">
            <div class="comment" *ngFor="let q of questions | slice:0:2">
              <img class="mini" src="https://i.pravatar.cc/40?u={{q.email}}" alt="" />
              <div>
                <div><strong>{{ q.name }}</strong> · <span class="muted">{{ q.email }}</span></div>
                <div class="muted" style="font-size:12px;">{{ q.created_at | date:'dd/MM/yyyy HH:mm' }}</div>
                <div style="margin-top:4px;"><span class="muted">Pregunta:</span> {{ q.message }}</div>
                <div *ngIf="q.answer" style="margin-top:4px;"><span class="muted">Respuesta:</span> {{ q.answer }}</div>
              </div>
            </div>
            <div *ngIf="questions.length > 2" style="margin-top:0.5rem;">
              <button class="link" (click)="openCommentsModal()">Ver más comentarios</button>
            </div>
          </ng-container>
          <ng-template #noComments>
            <div class="muted">Aún no hay comentarios</div>
          </ng-template>
        </div>

        <div class="card">
          <h3>Valoraciones</h3>
          <ng-container *ngIf="reviews && reviews.length > 0; else noReviews">
            <div class="review" *ngFor="let r of reviews | slice:0:2">
              <img class="mini" src="https://i.pravatar.cc/40?u={{r.email}}" alt="" />
              <div>
                <div><strong>{{ r.name }}</strong> · <span class="muted">{{ r.email }}</span></div>
                <div class="muted" style="font-size:12px;">{{ r.created_at | date:'dd/MM/yyyy HH:mm' }}</div>
                <!-- Estrellas de valoración -->
                <div class="rating-stars">
                  <span class="stars">{{ getStars(r.value).join('') }}</span>
                  <span class="rating-value">({{ r.value }}/5)</span>
                </div>
                <div style="margin-top:4px;"><span class="muted">Valoración:</span> {{ r.comment }}</div>
                <div *ngIf="r.answer" style="margin-top:4px;"><span class="muted">Respuesta:</span> {{ r.answer }}</div>
              </div>
            </div>
            <div *ngIf="reviews.length > 2" style="margin-top:0.5rem;">
              <button class="link" (click)="openReviewsModal()">Ver más valoraciones</button>
            </div>
          </ng-container>
          <ng-template #noReviews>
            <div class="muted">Aún no hay valoraciones</div>
          </ng-template>
        </div>
        </div>
      </div>
    </section>
  </div>
  
  <ng-template #loading>
    <div class="loading">
      <div class="spinner"></div>
      <p>Cargando perfil profesional...</p>
    </div>
  </ng-template>
  
  <div class="error" *ngIf="error">
    <p>{{ error }}</p>
    <button class="btn secondary" (click)="goBack()">Volver</button>
  </div>
</div>

<!-- Modal de comentarios -->
<app-comments-modal 
  [isOpen]="showCommentsModal"
  [questions]="questions"
  [userName]="professionalProfile?.name || 'Usuario'"
  [userId]="userId"
  (close)="closeCommentsModal()"
  (questionsUpdated)="onQuestionsUpdated($event)"
  (reloadRequested)="reloadQuestions()">
</app-comments-modal>

<!-- Modal de valoraciones -->
<app-reviews-modal 
  [isOpen]="showReviewsModal"
  [reviews]="reviews"
  [userName]="professionalProfile?.name || 'Usuario'"
  [userId]="userId"
  (close)="closeReviewsModal()"
  (reviewsUpdated)="onReviewsUpdated($event)"
  (reloadRequested)="reloadReviews()">
</app-reviews-modal>

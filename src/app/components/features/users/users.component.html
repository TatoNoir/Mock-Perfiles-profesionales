<section class="users">
  <div class="header">
    <h2 class="title">
      <svg class="title-icon" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5C15 14.17 10.33 13 8 13zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"></path>
      </svg>
      <span>Usuarios</span>
    </h2>
    <button class="btn primary" (click)="onAddUser()">Agregar Usuario</button>
  </div>
  <div class="table-wrap">
    <table class="table">
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Email</th>
          <th>Tipo de Usuario</th>
          <th>Localidad</th>
          <th>Último Acceso</th>
          <th>Modificado</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <!-- Loading state -->
        <tr *ngIf="loading">
          <td colspan="7" class="loading-cell">
            <div class="loading-spinner"></div>
            <span>Cargando usuarios...</span>
          </td>
        </tr>
        
        <!-- Error state -->
        <tr *ngIf="error && !loading">
          <td colspan="7" class="error-cell">
            <div class="error-message">
              {{ error }}
              <button class="btn secondary" (click)="loadUsers()">Reintentar</button>
            </div>
          </td>
        </tr>
        
        <!-- Users data -->
        <ng-container *ngIf="!loading && !error">
          <tr *ngFor="let u of users">
            <td>{{ u.name }}</td>
            <td class="muted">{{ u.email }}</td>
            <td>
              <span class="badge badge-user-type">{{ u.user_type.name }}</span>
            </td>
            <td>
              <span class="locality-info">
                {{ u.locality.name }}, {{ u.locality.province.name }}
              </span>
            </td>
            <td class="muted">{{ u.updated_at | date:'short' }}</td>
            <td class="muted">{{ u.updated_at | date:'short' }}</td>
            <td class="actions">
              <!-- Botones de acción -->
              <button class="btn secondary" (click)="onEditUser(u)">Editar</button>
              <button class="btn danger" (click)="onDeleteUser(u)">Eliminar</button>
              <button class="btn primary" (click)="onViewProfessionalProfile(u)">Ver perfil profesional</button>
            </td>
          </tr>
        </ng-container>
        
        <!-- Empty state -->
        <tr *ngIf="!loading && !error && users.length === 0">
          <td colspan="7" class="empty-cell">
            <div class="empty-message">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path>
              </svg>
              <span>No hay usuarios registrados</span>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</section>

<!-- Modal para agregar usuario -->
<app-add-user-modal 
  [isOpen]="showAddModal"
  (close)="onCloseAddModal()"
  (userCreated)="onUserCreated($event)"
></app-add-user-modal>

<!-- Modal para editar usuario -->
<app-edit-user-modal 
  [isOpen]="showEditModal"
  [user]="selectedUser"
  (close)="onCloseEditModal()"
  (userUpdated)="onUserUpdated($event)"
></app-edit-user-modal>


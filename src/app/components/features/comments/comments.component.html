<div class="comments-container">
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <h1 class="title">Comentarios</h1>
      <button class="btn btn-primary" (click)="addComment()">
        <i class="icon">+</i>
        Agregar Comentario
      </button>
    </div>
  </div>

  <!-- Filtros -->
  <div class="filters-section">
    <div class="filters-container">
      <div class="filter-group">
        <label for="userIdFilter">ID Usuario:</label>
        <input 
          type="number" 
          id="userIdFilter"
          [(ngModel)]="filters.user_id" 
          (ngModelChange)="onFilterChange()"
          placeholder="Filtrar por ID de usuario"
          class="filter-input"
        >
      </div>
      
      <div class="filter-group">
        <label for="messageFilter">Mensaje:</label>
        <input 
          type="text" 
          id="messageFilter"
          [(ngModel)]="filters.message" 
          (ngModelChange)="onFilterChange()"
          placeholder="Filtrar por mensaje"
          class="filter-input"
        >
      </div>
      
      <button 
        class="btn btn-secondary" 
        (click)="clearFilters()"
        [disabled]="!hasActiveFilters()"
      >
        Limpiar Filtros
      </button>
    </div>
  </div>

  <!-- Tabla de comentarios -->
  <div class="table-container">
    <div class="loading" *ngIf="loading">
      <div class="spinner"></div>
      <p>Cargando comentarios...</p>
    </div>

    <div class="error" *ngIf="error">
      <p>{{ error }}</p>
      <button class="btn btn-primary" (click)="loadComments()">Reintentar</button>
    </div>

    <table class="comments-table" *ngIf="!loading && !error">
      <thead>
        <tr>
          <th>Comentario</th>
          <th>Usuario</th>
          <th>Mail</th>
          <th>Creado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let comment of filteredComments; trackBy: trackByCommentId">
          <td class="comment-cell">
            <div class="comment-content">
              <p class="comment-message">{{ comment.message }}</p>
              <p class="comment-answer" *ngIf="comment.answer">
                <strong>Respuesta:</strong> {{ comment.answer }}
              </p>
            </div>
          </td>
          <td class="user-cell">
            <div class="user-info">
              <span class="user-name">{{ comment.name }}</span>
              <span class="user-id">ID: {{ comment.user_id }}</span>
            </div>
          </td>
          <td class="email-cell">{{ comment.email }}</td>
          <td class="date-cell">
            {{ comment.created_at ? formatDate(comment.created_at) : 'N/A' }}
          </td>
          <td class="actions">
            <button 
              class="btn secondary" 
              (click)="editComment(comment)" 
              aria-label="Editar comentario" 
              data-tooltip="Editar comentario"
            >
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1.003 1.003 0 0 0 0-1.42l-2.34-2.34a1.003 1.003 0 0 0-1.42 0l-1.83 1.83 3.75 3.75 1.84-1.82z"/>
              </svg>
            </button>
            <button 
              class="btn danger" 
              (click)="deleteComment(comment)" 
              aria-label="Eliminar comentario" 
              data-tooltip="Eliminar comentario"
            >
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M6 7h12v14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V7zm3-4h6l1 1h4v2H4V4h4l1-1z"/>
              </svg>
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="no-data" *ngIf="!loading && !error && filteredComments.length === 0">
      <p>No se encontraron comentarios</p>
      <button class="btn btn-primary" (click)="addComment()">Agregar Primer Comentario</button>
    </div>
  </div>
</div>
